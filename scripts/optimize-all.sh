#!/bin/bash

# ä¸»å„ªåŒ–è…³æœ¬ - åŸ·è¡Œæ‰€æœ‰å„ªåŒ–æ­¥é©Ÿ

echo ""
echo "ğŸš€ Buda Music å°ˆæ¡ˆå„ªåŒ–"
echo "================================"
echo ""
echo "æ­¤è…³æœ¬å°‡åŸ·è¡Œä»¥ä¸‹å„ªåŒ–ï¼š"
echo "  1. åœ–ç‰‡è½‰æ›ç‚º WebP æ ¼å¼ (é è¨ˆæ¸›å°‘ 40-50%)"
echo "  2. éŸ³æ¨‚é™ä½æ¯”ç‰¹ç‡åˆ° 128kbps (é è¨ˆæ¸›å°‘ 50%)"
echo "  3. æ›´æ–°ç¨‹å¼ç¢¼ä¸­çš„åœ–ç‰‡è·¯å¾‘"
echo ""
echo "é è¨ˆç¸½ç¯€çœç©ºé–“: ~220MB"
echo "é è¨ˆè™•ç†æ™‚é–“: 10-30 åˆ†é˜ (å–æ±ºæ–¼é›»è…¦æ€§èƒ½)"
echo ""

# è©¢å•ç¢ºèª
read -p "æ˜¯å¦ç¹¼çºŒ? (y/n) " -n 1 -r
echo
if [[ ! $REPLY =~ ^[Yy]$ ]]; then
    echo "âŒ å·²å–æ¶ˆå„ªåŒ–"
    exit 1
fi

echo ""
echo "é–‹å§‹å„ªåŒ–..."
echo ""

# è¨˜éŒ„é–‹å§‹æ™‚é–“
start_time=$(date +%s)

# æ­¥é©Ÿ 1: åœ–ç‰‡å„ªåŒ–
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "æ­¥é©Ÿ 1/3: åœ–ç‰‡å„ªåŒ–"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
bash scripts/compress-images.sh
if [ $? -ne 0 ]; then
    echo "âŒ åœ–ç‰‡å„ªåŒ–å¤±æ•—"
    exit 1
fi

# æ­¥é©Ÿ 2: éŸ³æ¨‚å„ªåŒ–
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "æ­¥é©Ÿ 2/3: éŸ³æ¨‚å„ªåŒ–"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
bash scripts/compress-music.sh
if [ $? -ne 0 ]; then
    echo "âŒ éŸ³æ¨‚å„ªåŒ–å¤±æ•—"
    exit 1
fi

# æ­¥é©Ÿ 3: æ›´æ–°åœ–ç‰‡è·¯å¾‘
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "æ­¥é©Ÿ 3/3: æ›´æ–°ç¨‹å¼ç¢¼"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
bash scripts/update-image-paths.sh
if [ $? -ne 0 ]; then
    echo "âŒ è·¯å¾‘æ›´æ–°å¤±æ•—"
    exit 1
fi

# è¨ˆç®—ç¸½è€—æ™‚
end_time=$(date +%s)
duration=$((end_time - start_time))
minutes=$((duration / 60))
seconds=$((duration % 60))

# é¡¯ç¤ºå®Œæˆè¨Šæ¯
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "ğŸ‰ å„ªåŒ–å®Œæˆï¼"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "ç¸½è€—æ™‚: ${minutes} åˆ† ${seconds} ç§’"
echo ""
echo "ğŸ“Š å„ªåŒ–çµ±è¨ˆï¼š"
echo "  âœ… åœ–ç‰‡å·²è½‰æ›ç‚º WebP æ ¼å¼"
echo "  âœ… éŸ³æ¨‚å·²é™ä½æ¯”ç‰¹ç‡åˆ° 128kbps"
echo "  âœ… ç¨‹å¼ç¢¼è·¯å¾‘å·²æ›´æ–°"
echo ""
echo "ğŸ” æª¢æŸ¥å„ªåŒ–çµæœï¼š"
du -sh public/morphing/* public/music/* 2>/dev/null | while read size path; do
    echo "  $path: $size"
done
echo ""
echo "ğŸ“¦ ä¸‹ä¸€æ­¥ï¼š"
echo "  1. åŸ·è¡Œ 'npm run build' é‡æ–°æ§‹å»ºå°ˆæ¡ˆ"
echo "  2. æ¸¬è©¦åŠŸèƒ½æ˜¯å¦æ­£å¸¸"
echo "  3. éƒ¨ç½²åˆ° v0"
echo ""
echo "ğŸ’¡ æç¤º: å¦‚æœéœ€è¦é‚„åŸï¼Œå‚™ä»½æ–‡ä»¶åœ¨ï¼š"
echo "  - src/composables/useImageSequence.ts.backup"
echo ""

